<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Продукти</title>
    <!-- Підключення Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container py-4">
        <h1 class="mb-4">Робота з продуктами</h1>
        
        <div id="responseBox" class="alert d-none mt-3"></div>
        <!-- Пошук продуктів -->
        <form id="searchForm" class="row g-3 mb-4">
            <div class="col-md-3">
                <input type="text" class="form-control" name="name" placeholder="Назва продукту">
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" name="priority" placeholder="Пріоритет">
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" name="categoryId" placeholder="Категорія">
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" name="price" placeholder="Ціна">
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100">Пошук</button>
            </div>
        </form>

        <!-- Список продуктів -->
        <div id="productsList" class="mb-4">
            <!-- Тут буде список продуктів -->
        </div>

        <!-- Додавання продукту -->
        <h2>Додати продукт</h2>
        <form id="addForm" class="row g-3 mb-4">
            <div class="col-md-3">
                <input type="text" class="form-control" name="name" placeholder="Назва" required>
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" name="priority" placeholder="Пріоритет" required>
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" name="categoryId" placeholder="Категорія" required>
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control" name="price" placeholder="Ціна" required>
            </div>
            <div class="col-md-3">
                <input type="text" class="form-control" name="description" placeholder="Опис">
            </div>
            <div class="col-md-12">
                <button type="submit" class="btn btn-success">Додати</button>
            </div>
        </form>

        <!-- Завантаження фото -->
        <h2>Завантажити фото</h2>
        <form id="uploadForm" class="mb-4">
            <input type="file" class="form-control mb-2" id="imageInput" accept="image/*" required>
            <button type="submit" class="btn btn-secondary">Завантажити</button>
        </form>

        <!-- Отримання продукту за Id -->
        <h2>Отримати продукт за Id</h2>
        <form id="getByIdForm" class="row g-3 mb-4">
            <div class="col-md-4">
                <input type="number" class="form-control" name="id" placeholder="Id продукту" required>
            </div>
            <div class="col-md-4">
                <button type="submit" class="btn btn-info">Отримати</button>
            </div>
        </form>

        <!-- Видалення продукту -->
        <h2>Видалити продукт</h2>
        <form id="deleteForm" class="row g-3">
            <div class="col-md-4">
                <input type="number" class="form-control" name="id" placeholder="Id продукту" required>
            </div>
            <div class="col-md-4">
                <button type="submit" class="btn btn-danger">Видалити</button>
            </div>
        </form>
    </div>

    <!-- Підключення Bootstrap JS (з Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Ваш JS-код для роботи з API тут -->
    <!-- Підключення axios CDN перед вашим JS-кодом -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const apiBase = 'https://lohika.itstep.click/api/Products';

        function showResponse(message, isError = false) {
            const box = document.getElementById('responseBox');
            box.className = 'alert mt-3 ' + (isError ? 'alert-danger' : 'alert-success');
            box.textContent = typeof message === 'string' ? message : JSON.stringify(message, null, 2);
            box.classList.remove('d-none');
        }

        // Пошук продуктів
        document.getElementById('searchForm').onsubmit = async function (e) {
            e.preventDefault();
            const params = Object.fromEntries(new FormData(this).entries());
            // Видаляємо порожні поля
            Object.keys(params).forEach(k => { if (!params[k]) delete params[k]; });
            try {
                let url = apiBase + (Object.keys(params).length ? '/search' : '/list');
                const res = await axios.get(url, { params });
                showResponse(res.data);
                renderProducts(res.data);
            } catch (err) {
                showResponse(err.response?.data || err.message, true);
            }
        };

        // Додавання продукту
        document.getElementById('addForm').onsubmit = async function (e) {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(this).entries());
            data.priority = Number(data.priority);
            data.categoryId = Number(data.categoryId);
            data.price = Number(data.price);
            data.ids = [];
            try {
                const res = await axios.post(apiBase + '/add', data);
                showResponse(res.data);
            } catch (err) {
                showResponse(err.response?.data || err.message, true);
            }
        };

        // Завантаження фото
        document.getElementById('uploadForm').onsubmit = async function (e) {
            e.preventDefault();
            const file = document.getElementById('imageInput').files[0];
            if (!file) return showResponse('Оберіть файл', true);
            const reader = new FileReader();
            reader.onload = async function () {
                const base64 = reader.result.split(',')[1];
                try {
                    const res = await axios.post(apiBase + '/upload', { image: base64 });
                    showResponse(res.data);
                } catch (err) {
                    showResponse(err.response?.data || err.message, true);
                }
            };
            reader.readAsDataURL(file);
        };

        // Отримання продукту за Id
        document.getElementById('getByIdForm').onsubmit = async function (e) {
            e.preventDefault();
            const id = this.id.value;
            try {
                const res = await axios.get(`${apiBase}/get/${id}`);
                showResponse(res.data);
            } catch (err) {
                showResponse(err.response?.data || err.message, true);
            }
        };

        // Видалення продукту
        document.getElementById('deleteForm').onsubmit = async function (e) {
            e.preventDefault();
            const id = this.id.value;
            try {
                const res = await axios.delete(`${apiBase}/delete/${id}`);
                showResponse(res.data);
            } catch (err) {
                showResponse(err.response?.data || err.message, true);
            }
        };

        // Відображення списку продуктів (простий приклад)
        function renderProducts(products) {
            const list = document.getElementById('productsList');
            if (!Array.isArray(products)) {
                list.innerHTML = '';
                return;
            }
            list.innerHTML = products.map(p => `
            <div class="card mb-2">
                <div class="card-body">
                    <h5 class="card-title">${p.name}</h5>
                    <p class="card-text">ID: ${p.id}, Категорія: ${p.categoryId}, Ціна: ${p.price}, Пріоритет: ${p.priority}</p>
                    <p class="card-text">${p.description || ''}</p>
                </div>
            </div>
        `).join('');
        }
    </script>
</body>
</html>
>